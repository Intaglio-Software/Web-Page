<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Human Civilization Simulation</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    canvas {
      display: block;
      margin: 20px auto;
      image-rendering: pixelated;
    }
    h1 {
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <h1>Human Civilization Simulation</h1>
  <canvas id="simCanvas" width="300" height="300"></canvas>

  <script>
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    const TILE_SIZE = 3;
    const WIDTH = canvas.width / TILE_SIZE;
    const HEIGHT = canvas.height / TILE_SIZE;

    const TICKS_PER_FRAME = 111;
    const FRAME_RATE = 30;
    const MAX_AGE = 300;

    const grid = [];
    const people = [];

    const TILE_EMPTY = 0;
    const TILE_BUILDING = 1;
    const TILE_FOOD = 2;

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    function createGrid() {
      for (let y = 0; y < HEIGHT; y++) {
        const row = [];
        for (let x = 0; x < WIDTH; x++) {
          row.push(Math.random() < 0.02 ? TILE_FOOD : TILE_EMPTY);
        }
        grid.push(row);
      }
    }

    function spawnPerson(x, y) {
      people.push({
        x, y,
        age: 0,
        hunger: 100,
        energy: 100,
        alive: true,
        fertile: true
      });
    }

    function tryReproduce(p) {
      if (!p.fertile || p.age < 50 || p.age > 150) return;
      for (const other of people) {
        if (other === p || !other.fertile || other.age < 50 || other.age > 150) continue;
        if (Math.abs(other.x - p.x) < 2 && Math.abs(other.y - p.y) < 2) {
          if (Math.random() < 0.01) {
            spawnPerson(p.x + randInt(-1, 2), p.y + randInt(-1, 2));
            p.fertile = false;
            other.fertile = false;
          }
        }
      }
    }

    function movePerson(p) {
      p.x += randInt(-1, 2);
      p.y += randInt(-1, 2);
      p.x = Math.max(0, Math.min(WIDTH - 1, p.x));
      p.y = Math.max(0, Math.min(HEIGHT - 1, p.y));
    }

    function updatePerson(p) {
      if (!p.alive) return;

      p.age++;
      p.hunger -= 1;
      p.energy -= 1;

      if (p.hunger <= 0 || p.age > MAX_AGE) {
        p.alive = false;
        return;
      }

      // Eat food
      if (grid[p.y][p.x] === TILE_FOOD) {
        grid[p.y][p.x] = TILE_EMPTY;
        p.hunger += 50;
      }

      // Build
      if (p.energy > 80 && Math.random() < 0.05) {
        grid[p.y][p.x] = TILE_BUILDING;
        p.energy -= 30;
      }

      // Reproduce
      tryReproduce(p);

      // Move
      movePerson(p);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < HEIGHT; y++) {
        for (let x = 0; x < WIDTH; x++) {
          let color = '#222';
          if (grid[y][x] === TILE_FOOD) color = '#2ecc71';
          else if (grid[y][x] === TILE_BUILDING) color = '#95a5a6';
          ctx.fillStyle = color;
          ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }
      }

      for (const p of people) {
        if (!p.alive) continue;
        ctx.fillStyle = `hsl(${(p.age / MAX_AGE) * 120}, 100%, 60%)`;
        ctx.fillRect(p.x * TILE_SIZE, p.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
      }
    }

    function simulateTick() {
      for (const p of people) updatePerson(p);
      // Chance of food regrowing
      if (Math.random() < 0.5) {
        const fx = randInt(0, WIDTH);
        const fy = randInt(0, HEIGHT);
        if (grid[fy][fx] === TILE_EMPTY) grid[fy][fx] = TILE_FOOD;
      }
    }

    function loop() {
      for (let i = 0; i < TICKS_PER_FRAME; i++) simulateTick();
      draw();
      requestAnimationFrame(loop);
    }

    // Init
    createGrid();
    for (let i = 0; i < 30; i++) {
      spawnPerson(randInt(0, WIDTH), randInt(0, HEIGHT));
    }
    loop();
  </script>
</body>
</html>
